<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:a4j="http://richfaces.org/a4j"
      xmlns:f="http://java.sun.com/jsf/core">

<h:body>
    <ui:composition template="templates/master.xhtml">
        <ui:define name="header">
        </ui:define>
        <ui:define name="content">
            <div class="createNewUser text-center">
                <h2 class="label-info">Create new user</h2>
                <h:form id="createUserForm" prependId="false" styleClass="form-group"
                        onkeypress="isFromValid($(this));" onclick="isFromValid($(this));">
                    <div class="col-md-1"></div>
                    <div class="col-md-4" onkeypress="isFromValid($(this));">
                        <div class="row">
                            <h:outputLabel value="Name:" />
                            <h:inputText id="nameInput" styleClass="input-sm form-control"
                                         value="#{newUserBean.newUserDTO.name}" onkeyup="validateField($(this), nameRegex);"
                                         onblur="validateField($(this), nameRegex);"
                                         onchange="capitalize($(this));"/>
                        </div>
                        <div class="row">
                            <h:outputLabel value="Last Name:" />
                            <h:inputText id="lastNameInput" styleClass="input-sm form-control"
                                         value="#{newUserBean.newUserDTO.lastName}" onkeyup="validateField($(this), nameRegex);"
                                         onblur="validateField($(this), nameRegex);"
                                         onchange="capitalize($(this));"/>
                        </div>
                        <div class="row">
                            <h:outputLabel value="Address 1:" />
                            <h:inputText id="address1Input" styleClass="input-sm form-control"
                                         value="#{newUserBean.newUserDTO.address1}" onkeyup="validateField($(this), regularRegex);"
                                         onblur="validateField($(this), regularRegex);"/>
                        </div>
                        <div class="row">
                            <h:outputLabel value="Address 2:" />
                            <h:inputText id="address2Input" styleClass="input-sm form-control"
                                         value="#{newUserBean.newUserDTO.address2}" onkeyup="validateField($(this), addressRegex);"
                                         onblur="validateField($(this), addressRegex);"/>
                        </div>
                        <div class="row">
                            <h:outputLabel value="City:" />
                            <h:inputText id="cityInput" styleClass="input-sm form-control"
                                         value="#{newUserBean.newUserDTO.city}" onkeyup="validateField($(this), regularRegex);"
                                         onblur="validateField($(this), regularRegex);"
                                         onchange="capitalize($(this));"/>
                        </div>
                        <div class="row">
                            <h:outputLabel value="Birth Date:" />
                            <h:inputText id="dateInput" styleClass="input-sm form-control"
                                         value="#{newUserBean.newUserDTO.dateString}" onkeyup="validateField($(this), dateRegex);"
                                         onblur="validateField($(this), dateRegex);"/>
                        </div>
                    </div>
                    <div class="col-md-2"></div>
                    <div class="col-md-4" onkeypress="isFromValid($(this));">
                        <div class="row">
                            <h:outputLabel value="Username:" />
                            <h:inputText id="usernameInput" styleClass="input-sm form-control"
                                         value="#{newUserBean.newUserDTO.username}" onkeyup="validateField($(this), usernameRegex);"
                                         onblur="validateField($(this), usernameRegex);"/>
                        </div>
                        <div class="row">
                            <h:outputLabel value="E-mail:" />
                            <h:inputText id="mailInput" styleClass="input-sm form-control"
                                         value="#{newUserBean.newUserDTO.email}" onkeyup="validateField($(this), emailRegex);"
                                         onblur="validateField($(this), emailRegex);"/>
                        </div>
                        <div class="row">
                            <h:outputLabel value="E-mail (repeat):" />
                            <h:inputText id="mailRepeat" styleClass="input-sm form-control" onkeyup="validateMatching($('#mailInput'), $(this));"
                                         onblur="validateMatching($('#mailInput'), $(this));"/>
                        </div>
                        <div class="row">
                            <h:outputLabel value="Password:" />
                            <h:inputSecret id="passwordInput" styleClass="input-sm form-control"
                                           value="#{newUserBean.newUserDTO.password}" onkeyup="validateField($(this), passwordRegex);"
                                           onblur="validateField($(this), passwordRegex);"/>
                        </div>
                        <div class="row">
                            <h:outputLabel value="Password (repeat):" />
                            <h:inputSecret id="passwordRepeat" styleClass="input-sm form-control" onkeyup="validateMatching($('#passwordInput'), $(this));"
                                           onblur="validateMatching($('#passwordInput'), $(this));"/>
                        </div>
                        <div class="row padding-horizontal-15px">
                            <a4j:commandButton id="createNewUserButton" execute="@form" render="@all"
                                             action="#{newUserBean.saveNewUser}"
                                             styleClass="btn btn-primary displayNone" value="Create"/>
                            <a4j:commandButton id="createNewUserButtonDisabled" execute="@none" render="@none"
                                               styleClass="btn btn-primary disabled displayInline" value="Create"/>
                        </div>
                    </div>
                    <div class="col-md-1"></div>
                </h:form>
                <script type="text/javascript">
                    var emailRegex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
                    var nameRegex = /^(?=.*[a-zA-Z]{1,})(?=.*[\d]{0,})[a-zA-Z0-9]{1,45}$/;
                    var usernameRegex = /^(?=.{3,20}$)(?![_.-])(?!.*[_.-]{2})[a-zA-Z0-9_-]+([^._-])$/;
                    var passwordRegex = /^((?=\S*?[A-Z])(?=\S*?[a-z])(?=\S*?[0-9]).{6,})\S$/;
                    var dateRegex = /^(19[5-9][0-9]|20[0-4][0-9]|2050)-(0[1-9]|1[0-2])-([1-9]|[12][0-9]|3[01])$/;
                    var regularRegex = /^[a-zA-Z0-9 ]{3,35}$/;
                    var addressRegex = /^[a-zA-Z0-9 ]{0,35}$/;

                    function resetInput(el) {
                        el.removeClass('has-error');
                        el.removeClass('has-success');
                    }
                </script>
            </div>
        </ui:define>
        <ui:define name="messages">
            <h:panelGroup id="messagesContainer" rendered="true">
                <div id="messagesDiv" class="alert alert-danger displayNone"></div>
                <h:panelGroup rendered="#{newUserBean.controller.userExists}">
                    <div id="userExists" class="alert alert-danger">
                        <a href="#" class="close" onclick="hideEl($('#userExists'))">&times;</a>
                        User with given username already exists, please choose other username.
                    </div>
                </h:panelGroup>
                <!--<div id="emailExists" class="alert alert-danger">-->
                    <!--<h:panelGroup>-->
                        <!--<a href="#" class="close" onclick="hideEl($('#emailExists'))">&times;</a>-->
                        <!--E-mail exists in database, please choose other or login with username if you already have one.-->
                    <!--</h:panelGroup>-->
                <!--</div>-->
            </h:panelGroup>
        </ui:define>
    </ui:composition>
</h:body>

</html>